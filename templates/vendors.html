{% extends "base.html" %}
{% block body %}
<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/producers.css')}}" />

<p style="text-align:center"> Welcome {{user.Name}} </p>

<h1> {{message}} </h1>

<form action="/addvendors" method="POST" style="float:left; width:47%">
    <h3> Add New Vendor </h3>
    <span> Name: </span><input type="text" name="name"><br>
    <span> Email: </span><input type="text" name="email" /><br>
	<span> Phone: </span><input type="text" name="phone" /><br>
	<span> Address: </span><input type="text" name="address" /><br>
	<span> Owner Name: </span><input type="text" name="owner_name" /><br>
    <input type="submit" value="Add New" />
</form>

{% if user.Salary %}

<form action="/modvendors" method="POST" style="float:right; width:47%">
    <h3> Modify Vendor by ID</h3>
    <span> ID: </span><input type="text" name="id" /><br>
	<span> Name: </span><input type="text" name="name" /><br>
	<span> Email: </span><input type="text" name="email" /><br>
	<span> Phone: </span><input type="text" name="phone" /><br>
	<span> Address: </span><input type="text" name="address" /><br>
	<span> Owner Name: </span><input type="text" name="owner_name" /><br>
    <input type="submit" value="Add New" />
</form>

<div style="margin-bottom:20px; clear:both"> </div>

{% endif %}

<h2> List of Vendor </h2>
<table cellspacing="20px" style="text-align:center">
	<thead>
		<tr>
			<td>ID</td>
			<td>Name</td>
			<td>Email</td>
			<td>Owner</td>
			<td>Phone</td>
			<td>Address</td>
		</tr>
	</thead>
	<tbody>
		{% for vendor in list_party %}
			<tr onclick="analize({{vendor.V_ID}});">
				<td>{{vendor.V_ID}}</td>
				<td>{{vendor.V_Name}}</td>  
				<td>{{vendor.Email}}</td>
				<td>{{vendor.Owner_Name}}</td>
				<td>{{vendor.PhoneNum}}</td>
				<td>{{vendor.Address}}</td>
				{% for ministat in stat %}
					{% if ministat.V_ID == vendor.V_ID %}
						<td> {{ministat.sum}}</td>
					{% endif %}
				{% endfor %}
				{% if user.Salary%}
					<td><button> Modify </button></td>
					<td>
						<form method="POST" action="/delvendor">
							<input type="text" name="v_id" value={{vendor.V_ID}} style="display:none"/>
							<input type="submit" value="delete"/> 
						</form>
					</td>

				{% endif %}
				{% for export in list_order %}
					{% if export.V_ID == vendor.V_ID %}
					<tr > 
						<td colspan=6>
							SKU: {{export.SKU}}
							Amount: {{export.Amount}}$
							Total Price: {{export.Total_Price}}
							Date {{export.Date_info}}
						</td>
					</tr> 
					{% endif%}
				{% endfor%}
		{% endfor %}
	</tbody>
</table>

<script type="text/javascript">
	function analize(v_id){
		fetch("http://35.182.249.219:5000/api/vendors/"+v_id)
			.then((value) => value.json())
			.then((valueJSON)=> {
				console.log(valueJSON);
				let output = valueJSON[0]["COUNT(*)"] +" Export Order Was Made with this Vendor";
				confirm(output);
			});
	}
</script>


{% endblock body %}
